<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>欢迎注册</title>
    <script src="js/jquery.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet"/>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/cookie.js"></script>
    <style>

    </style>
    <script>
        $(document).ready(function () {
            // 重置表单
            $("#reset").click(function () {
                $("#username").val("");
                $("#passwd").val("");
                $("#rpasswd").val("");
            });
            // 检查用户名是否重复
            $("#username").blur(function () {
                if ($("#username").val() == "") {
                    alert("请输入用户名");
                    return
                }
                $.ajax({
                    type: "GET",
                    url: "http://127.0.0.1:8000/user/checkname?username=" + $("#username").val(),
                    dataType: "jsonp",
                    jsonp: "callback",
                    success: function (data) {
                        if (data["data"] == "用户名重复") {
                            $("#nametext").html("<strong style='color: red'>用户名已存在</strong>");
                        } else if (data["data"] == "用户名可用") {
                            $("#nametext").html("<strong style='color: green'>用户名可用</strong>");
                        } else {
                            alert("系统错误");
                        }
                    },
                    error: function () {
                        alert("加载失败");
                    },
                });
            });
            // 提交表单
            $("#submit").click(function () {
                $("#username").trigger("blur");
                $("#passwd").trigger("blur");
                $("#rpasswd").trigger("blur");
                $.ajax({
                    type: "GET",
                    url: "http://127.0.0.1:8000/user/zhuce?" + "username=" + $("#username").val() + "&password=" + $("#passwd").val(),
                    dataType: "jsonp",
                    jsonp: "callback",
                    success: function (data) {
                        if (data["errno"] == 0) {
                            $.cookie("userid", data["data"], {expires: 1});
                            location.href = "./login.html";
                        }
                    },
                    error: function () {
                        alert("加载失败");
                    },
                });
            });
            // 检查两次密码是否相同
            $("#rpasswd").blur(function () {
                if ($("#passwd").val() != $("#rpasswd").val()) {
                    $("#repwdtext").html("<strong style='color: red'>两次密码输入不一致</strong>");
                    return
                } else {
                    $("#repwdtext").html("");
                }
            });
            // 检查密码是否符合要求
            $("#passwd").blur(function () {
                var re = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,16}$/;
                if (!re.test($("#passwd").val())) {
                    $("#pwdtext").html("<strong style='color: red'>密码必须包含字母和数字，长度8到16</strong>");
                } else {
                    $("#pwdtext").html("");
                }
            });
        });
    </script>
</head>
<body>
<div class="container" style="padding-top:20px;">
    <div class="row" style="background-color:#b9bbbe;">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-12">
                    <div class="text-center"><h1>欢迎来到专向订阅爬虫</h1></div>
                </div>
            </div>
        </div>
    </div>
    <div class="row" style="background-color:paleturquoise;">
        <div class="col-md-12">
            <div class="text-center"><h3>注册页面</h3></div>
        </div>
        <div class="col-md-3"></div>
        <form class="col-md-9" role="form">

            <div class="row">
                <div class="col-md-2">用户名：</div>
                <div class="col-md-4">
                    <input id="username" type="text" class="form-control" name="username"/>
                </div>
                <div class="col-md-6" id="nametext"></div>
            </div>
            <div class="row">
                <div class="col-md-2">输入密码：</div>
                <div class="col-md-4">
                    <input id="passwd" type="password" class="form-control" name="password"/>
                </div>
                <div class="col-md-6" id="pwdtext"></div>
            </div>
            <div class="row">
                <div class="col-md-2">再次输入密码：</div>
                <div class="col-md-4">
                    <input id="rpasswd" type="password" class="form-control"/>
                </div>
                <div class="col-md-6" id="repwdtext"></div>
            </div>
            <div class="row">
                <div style="height:20px;"></div>
            </div>
            <div class="row">
                <div class="col-md-3"></div>
                <div class="col-md-1"><input id="submit" class="btn btn-primary" type="button" value="提交"></div>
                <div class="col-md-1"><input id="reset" class="btn btn-primary" type="button" value="重置"></div>
            </div>
        </form>
    </div>
    <div class="row" style="background-color:azure;">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-12">
                    <div style="text-align: center">
                        <h1>dh爱你的我&copy;版权所有</h1>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>